<!DOCTYPE html>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width" />
  <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' />

  <!-- LINKS -->
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,800,700" rel="stylesheet">
  <link href="/styles/font-awesome.css" rel="stylesheet">
  <link href="/styles/style.css" rel="stylesheet">
  <link href="/styles/bootstrap.min.css" rel="stylesheet">

  <!-- SRCIPTS -->
  <script src="/libraries/jquery-3.1.1.min.js" type="text/javascript" charset="utf-8"></script>
  <script src="/libraries/d3.v4.min.js" type="text/javascript" charset="utf-8"></script>
  <script src="/libraries/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
  <script src="//d3js.org/d3.v3.min.js"></script>
  <script src="//d3plus.org/js/d3.js"></script>
  <script src="//d3plus.org/js/d3plus.js"></script>
	<script src="/javascript/popup_handler.js"></script>
  <body>
    <div class="header_container">
      <script>
      $(".header_container").load("/header.html", function() {
        $("#work_link").addClass("current_page");
      });
      </script>
    </div>

    <div id="workSideNav" class="sidenav">
    </div>

    <script>

    function elemClearlyVisible(elem, downScroll) {
      var docViewTop = $(window).scrollTop();
      var docViewMiddle = docViewTop + $(window).height()/2;

      var elemTop = $(elem).offset().top;
      var elemBottom = elemTop + $(elem).height();
      if (downScroll) return ((elemTop <= docViewMiddle) && (elemTop >= docViewTop));
      else return ((elemBottom <= docViewMiddle) && (elemBottom >= docViewTop));
    }

    function updateCurrentHighlightedSubsection(subsection) {
      elemToRemoveHighlight = $(getLinkIdFromSubsectionId(subsections[currentHighlightedSubsection]));
      elemToRemoveHighlight.removeClass("current_subsection");
      currentHighlightedSubsection = subsection;
      elemToHighlight = $(getLinkIdFromSubsectionId(subsections[currentHighlightedSubsection]));
      elemToHighlight.addClass("current_subsection");
    }

    function getLinkIdFromSubsectionId(subsection_id){
      return subsection_id + '_link';
    }

    function configureSmoothScrolling(){
      $('a[href*="#"]')
      // Remove links that don't actually link to anything
      .not('[href="#"]')
      .not('[href="#0"]')
      .click(function(event) {
        // On-page links
        if (
          location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '')
          &&
          location.hostname == this.hostname
        ) {
          // Figure out element to scroll to
          var target = $(this.hash);
          target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
          // Does a scroll target exist?
          if (target.length) {
            // Only prevent default if animation is actually gonna happen
            event.preventDefault();
            $('html, body').animate({
              scrollTop: target.offset().top - ($('.header').outerHeight() - 1)
            }, 1000, function() {
              // Callback after animation
              // Must change focus!
              var $target = $(target);
              // $target.focus();
              //TODO: Push state to URL
              if ($target.is(":focus")) { // Checking if the target was focused
                return false;
              } else {
                $target.attr('tabindex','-1'); // Adding tabindex for elements not focusable
                // $target.focus(); // Set focus again
              };
            });
          }
        }
      });
    }

    function mod(m, n){
      /**
      Returns m mod n
      **/
      return ((m % n) + n) % n;
    }

    var links = ['MACHINE LEARNING', 'RAPID PROTOTYPING', 'SECURITY', 'NETWORKS',
            'NATURAL LANGUAGE PROCESSING', 'VISUAL', 'GAME DESIGN', 'OTHER',
            'SHELVED PROJECTS'];
    var links_html = '';
    var subsections = []
    for (var i = 0; i < links.length; i++) {
      text = links[i]
      href = '#'+text.replace(/\ +/g, '_').toLowerCase();
      id = text.replace(/\ +/g, '_').toLowerCase() + '_link';
      links_html += '<a id=' + id + ' href=' + href + '>' + text + '</a>'
      subsections.push(href)
    }
    $('#workSideNav').html(links_html);

    var currentHighlightedSubsection = 0;
    updateCurrentHighlightedSubsection(0);

    $(document).scroll(function() {
      x = $(document).width()/2;
      y = $(".header").outerHeight();
      elem_id = '#' + $(document.elementFromPoint(x, y)).attr('id');
      elem_id = elem_id.replace(/[0-9]+/i,""); //get rid of trailing numbers
      elem_id = elem_id.replace(/_title/i,""); //get rid of _title
      elem_id = elem_id.replace(/_separator/i,""); //get rid of _separator
      elem_idx = $.inArray(elem_id, subsections);
      if (elem_idx != -1){
        updateCurrentHighlightedSubsection(elem_idx);
      }
    });



    configureSmoothScrolling();

    </script>

    <div class="work_container">
      <div class="work_section_clicked"></div>
      <div id="machine_learning">
        <p>
          <b>Support for Mobile coming soon!</b> <br/>
        </p>
        <h4 id="machine_learning_title" >Machine Learning</h4>
      </div>

      <hr class="between_section" id="rapid_prototyping_separator">

      <div id="rapid_prototyping" >
        <h4 id="rapid_prototyping_title">Rapid Prototyping</h4>
      </div>

      <hr class="between_section" id="security_separator">

      <div id="security">
        <h4 id="security_title">Security</h4>
      </div>

      <hr class="between_section" id="networks_separator">

      <div id="networks">
        <h4 id="networks_title">Networks</h4>
      </div>

      <hr class="between_section" id="natural_language_processing_separator">

      <div id="natural_language_processing">
        <h4 id="natural_language_processing_title">Natural Language Processing</h4>
      </div>

      <hr class="between_section" id="visual_separator">

      <div id="visual">
        <h4 id="visual_title">Visual</h4>
      </div>

      <hr class="between_section" id="game_design_separator">

      <div id="game_design">
        <h4 id="game_design_title">Game Design</h4>
      </div>

      <hr class="between_section" id="other_separator">

      <div id="other">
        <h4 id="other_title">Other</h4>
      </div>

      <hr class="between_section" id="shelved_projects_separator">

      <div id="shelved_projects">
        <h4 id="shelved_projects_title">Shelved Projects</h4>
      </div>

    </div>
    <script>

    function displayProjects(project, i, category, i_limit){
      var raw_category = category.slice(1);
      var img_width = document.body.clientWidth/2;
      var project_html;
      var link = project.link;
      var section_id = raw_category + i;
      if (link != undefined) {
        project_html = '<br> <div class="work_section_link work_section" id=' + section_id + '>';
      } else {
        project_html = '<br> <div class="work_section" id=' + section_id + '>';
      }

      project_html += '<div class="project_thumbnail_container"><img class="project_thumbnail" src=' + project.image + '></div>';
      project_html += '<div class="project_details">';
      project_html += '<p class="project_title"> <b>' + project.title + '</b></p>';
      project_html += '<p class="project_date">' + project.date + '</p>';
      project_html += '<p class="project_description"><i>' + project.description + '</i></p>';
      project_html += '</div> </div> <br>';
      if (i < i_limit) project_html += '<hr class="between_story" />';
      $(category).append(project_html);

      if (link != undefined) {
				console.log(section_id);
        $('#'+section_id).click(function(){
          open_popup(this, link);
        });
      }
    }

    $.getJSON("/work/work.json", function(data) {
      for (var i = 0; i < subsections.length; i++) {
        subsection = subsections[i].slice(1);
        data[subsection].forEach(function(project, j){
          displayProjects(project, j, subsections[i], data[subsection].length - 1);
        });
      }
    });
    </script>


  </body>
</html>